var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var e=b.length,f=a.length,h=Math.max(0,Math.min(c|0,b.length)),g=0;g<f&&h<e;)if(b[h++]!=a[g++])return!1;return g>=f}},"es6-impl","es3");var latLng_p="",address="",gpId="";
function getAddress(a){(new google.maps.Geocoder).geocode({location:a},function(b,c){latLng_p=a;"OK"===c?b[0]?(address=b[0].formatted_address,gpId=b[0].place_id,refreshAddress()):console.log("No geoCoding results found"):console.log("Geocoder failed due to: "+c);pendingCitySubmit&&(execSubmitCity(),pendingCitySubmit=!1)})}function toggleAddress(){"hide"==address_text.classList.value?showAddress():hideAddress()}
function showAddress(){address_text_content.innerText=address;address_text.classList.remove("hide")}function hideAddress(){address_text_content.innerText="";address_text.classList.add("hide")}function clearAddress(){gpId=address="";address_text_content.innerText=""}function refreshAddress(){address_text.classList.contains("hide")||(address_text_content.innerText=address)}function copyAddress(){copyNodeText(address_text_content)}
var DEFAULT_WCODE=["bangalore","diesel","hall","planet"],pendingCity=!1;function noCity(a){showAddress();showNoCityMessage();infoWindow.setContent("Location not in database")}function submitCity(){""==address?pendingCitySubmit=!0:(execSubmitCity(),pendingCity=!0)}
function execSubmitCity(){var a=firebase.database().ref().child("CityRequest").push().key,b={};b["/CityRequest/"+a]={time:firebase.database.ServerValue.TIMESTAMP,lat_lng:latLng_p,gp_id:gpId,address:address,processed:!1};firebase.database().ref().update(b);showNotification("Request submitted")}function tryDefaultCity(){decode(DEFAULT_WCODE);notification_top.classList.add("hide");infoWindow.close()}var urlFunctions="https://location.wcodes.org/api/";
function encode_(a,b){var c=new XMLHttpRequest;c.open("POST",urlFunctions+"encode",!0);c.setRequestHeader("Content-type","application/json");c.setRequestHeader("version",1);wait_loader.classList.remove("hide");c.onreadystatechange=function(){4==c.readyState&&(200==c.status?(setCodeWords(c.responseText,a,b),wait_loader.classList.add("hide")):204==c.status&&(noCity(b),notification_top.classList.remove("hide"),wait_loader.classList.add("hide")))};c.send(stringifyEncodeData(a.center,b));return""}
function setCodeWords(a,b,c){var d=[];d.push(b.name);a=JSON.parse(a).code;a=$jscomp.makeIterator(a);for(b=a.next();!b.done;b=a.next())i=b.value,d.push(wordList.getWord(i));setWcode(d,c)}function stringifyEncodeData(a,b){var c={};c.city_center=a;c.position=b;return JSON.stringify(c)}
function decode_(a,b){var c=new XMLHttpRequest;c.open("POST",urlFunctions+"decode",!0);c.setRequestHeader("Content-type","application/json");c.setRequestHeader("version",1);wait_loader.classList.remove("hide");c.onreadystatechange=function(){4==c.readyState&&200==c.status&&(setCodeCoord(c.responseText,Array(a.name).concat(b)),notification_top.classList.add("hide"),wait_loader.classList.add("hide"))};var d=[];d[0]=wordList.indexOf(b[0]);d[1]=wordList.indexOf(b[1]);d[2]=wordList.indexOf(b[2]);c.send(stringifyDecodeData(a.center,
d))}function stringifyDecodeData(a,b){var c={};c.city_center=a;c.code=b;return JSON.stringify(c)}function setCodeCoord(a,b){var c=JSON.parse(a);focus__(c,b)}var WCODE_CODE_COPIED_MESSAGE="WCode copied to clipboard",WCODE_LINK_COPIED_MESSAGE="WCode link copied to clipboard";function showCopyWcodeMessage(){copy_wcode_message_city_name.innerText=getWcodeCity();copy_wcode_message.classList.remove("hide")}
function hideCopyWcodeMessage(){copy_wcode_message.classList.add("hide");copy_wcode_message_city_name.innerText=""}function copyWcodeFull(){showAndCopy(getWcodeFull_formatted().join(" "));showNotification(WCODE_CODE_COPIED_MESSAGE);hideCopyWcodeMessage()}function copyWcodeCode(){showAndCopy(getWcodeCode_formatted().join(" "));showNotification(WCODE_CODE_COPIED_MESSAGE);hideCopyWcodeMessage()}
function copyWcodeLink(){var a=location.hostname+"/"+getWcodeFull().join(".");showAndCopy(a.toLowerCase());showNotification(WCODE_LINK_COPIED_MESSAGE)}var CityList,city_styled_wordlist=[],city_plus_wordList=[],pendingPosition,pendingWords,wordList,PURE_WCODE_CITY_PICKED="Since your city is not set - city was chosen from the last location",PURE_WCODE_CITY_FAILED="Since your city is not set - you must first choose the city or preceed the WCode with city name";
function getCityFromPosition(a){var b;CityList.forEach(function(c){var d=Math.abs(c.center.lng-a.lng);.25>Math.abs(c.center.lat-a.lat)&&.25>d&&(null==b||b.dLng>d)&&(b={city:c,dLng:d})});return null==b?null:b.city}function getCityFromName(a){for(var b=0;b<CityList.length;b++)if(0==CityList[b].name.toLowerCase().localeCompare(a))return CityList[b];return null}
function encode(a){clearWcode();if(null!=CityList){var b=getCityFromPosition(a);null==b?pendingCity||(pendingPosition=a,noCity(a)):(pendingCity&&(hideNoCityMessage(),infoWindow_setContent(MESSAGE_LOADING),pendingCity=!1),encode_(b,a))}else pendingPosition=a}
function decode(a){if(null!=CityList){var b,c=!1,d=a.length-3;if(3<a.length)b=a.slice(0,d).join(" "),b=getCityFromName(b),c=!0;else if(3==a.length){if(null==myLocDot){null!=marker&&null!=marker.position?(c=marker.position,focus(c),showNotification(PURE_WCODE_CITY_PICKED)):showNotification(PURE_WCODE_CITY_FAILED);return}c=myLocDot.position;null!=c&&(b=getCityFromPosition(resolveLatLng(c)));c=null!=b?!0:!1}if(c)for(var e=0;3>e;e++)if(1!=wordList.includes(a[d+e])){c=!1;break}c?decode_(b,a.slice(d,a.length)):
showNotification(INCORRECT_WCODE)}else pendingWords=a}firebase.database().ref("WordList").on("value",function(a){wordList=new WordList(a.val());null!=CityList&&initData()});firebase.database().ref("CityList").on("value",function(a){CityList=a.val();CityList.forEach(function(a){city_styled_wordlist.push(a.name);city_plus_wordList.push(a.name.toLowerCase())});null!=wordList&&initData()});
function initData(){city_plus_wordList=city_plus_wordList.concat(wordList.wordList);null!=pendingPosition?encode(pendingPosition):null!=pendingWords&&decode(pendingWords)}function logCode(a,b){console.log("Code:");console.log(a);console.log(b);console.log("--")}
function logDifference(a,b,c){var d=Math.round(1E6*(a-curPos.lat))/1E6,e=Math.round(1E6*(b-curPos.lng))/1E6;console.log("Difference:");console.log(d+" "+e);console.log(curPos.lat+" "+curPos.lng);console.log(a+" "+b);console.log(c);console.log("--")}
var map,marker,infoWindow,accuCircle,myLocDot,poiPlace,pendingLocate=!1,pendingCitySubmit=!1,infoWindow_open=!1,DEFAULT_LATLNG={lat:-34.397,lng:150.644},INCORRECT_WCODE='INCORRECT INPUT! Should be at least 3 WCode words, optionally preceded by a city. E.g: "Bangalore cat apple tomato"',MESSAGE_LOADING="Loading ..",LOCATION_PERMISSION_DENIED="Location permission was denied. Click to point or retry with the locate button";
function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:DEFAULT_LATLNG,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.BOTTOM_CENTER},zoom:8,fullscreenControl:!1,streetViewControl:!1,zoomControl:!1});var a=document.getElementById("pac-input"),b=new google.maps.places.SearchBox(a);map.controls[google.maps.ControlPosition.TOP_LEFT].push(a);map.addListener("bounds_changed",function(){b.setBounds(map.getBounds())});
var c=[];b.addListener("places_changed",function(){var a=b.getPlaces();if(0!=a.length){clearMap();c.forEach(function(a){a.setMap(null)});c=[];var e=new google.maps.LatLngBounds;1==a.length?(clearAddress(),a=resolveLatLng(a[0].geometry.location),focus_(a),encode(a),getAddress(a)):(a.forEach(function(a){if(a.geometry){var b={url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},b=new google.maps.Marker({map:map,
icon:b,title:a.name,position:a.geometry.location});b.addListener("click",function(){load(this)});c.push(b);a.geometry.viewport?e.union(a.geometry.viewport):e.extend(a.geometry.location)}else console.log("Returned place contains no geometry")}),map.fitBounds(e))}});map.addListener("click",function(a){pendingPosition=null;notification_top.classList.add("hide");clearAddress();clearURL();a=resolveLatLng(a.latLng);focus_(a);encode(a)});location_button.addEventListener("click",function(){locate(!0)});decode_button.addEventListener("click",
function(){clearMap();suggestion_result.setInnerText="";var a=document.getElementById("pac-input").value;execDecode(a)});document.getElementById("pac-input").addEventListener("input",suggestComplete);new ClickEventHandler(map)}function resolveLatLng(a){return{lat:a.lat(),lng:a.lng()}}function execDecode(a){a=a.replace(/(\\|\/)/gm,"").trim().toLowerCase();var b=!0;if(0<a.length){var c;c=-1!=a.indexOf(" ")?" ":".";a=a.split(c);3>a.length?b=!1:decode(a)}b||showNotification(INCORRECT_WCODE)}
function suggestComplete(a){a=document.getElementById("pac-input").value.toLowerCase().split(" ");var b;0<a.length&&(b=getPossibleList(a.slice(0,-1)));if(null!=b){var c=a[a.length-1];if(b!=city_styled_wordlist&&b!=wordList.curList){var d=a.slice(0,-1).join(" ")+" ",e=[],f=new RegExp(d,"ig");b.forEach(function(a){a.toLowerCase().startsWith(d)&&e.push(a.replace(f,""))});b=e}changeInput(b,c)}else suggestion_result.innerText=""}
function getPossibleList(a){var b;if(0==a.length)b=city_styled_wordlist;else{var c;for(c=a.length;0<c;c--)if(b=a.slice(0,c).join(" "),getCityFromName(b)){b=wordList.curList;break}else if((b=matchWord(city_styled_wordlist,b))&&0<b.length)break;for(;c<a.length;c++)if(wordList.indexOf(a[c]))b=wordList.curList;else return null}return b}
function matchWord(a,b){var c=new RegExp(b.split("").join("\\w*").replace(/\W/,""),"i");return a.filter(function(a){if(a.match(c)&&a.toLowerCase().startsWith(b))return a})}function changeInput(a,b){var c=matchWord(a,b);suggestion_result.innerText="";if(1!=c.length||b!=c[0].toLowerCase())if(5>c.length||2<b.length)for(var d=0;d<c.length&&10>d;d++){var e=document.createElement("div");e.innerText=c[d];e.addEventListener("click",chooseWord);suggestion_result.appendChild(e)}}
function chooseWord(a){a=document.getElementById("pac-input").value.split(" ");a[a.length-1]=this.innerText;document.getElementById("pac-input").value=a.join(" ")+" ";document.getElementById("pac-input").focus();suggestion_result.innerText=""}var lastMarker;function load(a){focus_(a.position);window.marker.title=a.title;infoWindow.open(map,window.marker);infoWindow_open=!0;a.setVisible(!1);lastMarker=a;infoWindow_setContent(MESSAGE_LOADING);encode(a.position)}
function focus__(a,b){focus_(a);setWcode(b,a)}var ClickEventHandler=function(a){this.map=a;this.placesService=new google.maps.places.PlacesService(a);this.map.addListener("click",this.handleClick.bind(this))};ClickEventHandler.prototype.handleClick=function(a){a.placeId?(a.stop(),this.getPlaceInformation(a.placeId)):getAddress(resolveLatLng(a.latLng))};
ClickEventHandler.prototype.getPlaceInformation=function(a){this.placesService.getDetails({placeId:a},function(a,c){"OK"===c&&(poiPlace=a,address=a.formatted_address,refreshAddress())})};
function focus_(a,b){hideNoCityMessage();"undefined"===typeof marker?(marker=new google.maps.Marker({position:a,map:map,title:"Hello World!"}),marker.addListener("click",function(){0==infoWindow_open?(infoWindow.open(map,marker),infoWindow_open=!0):(infoWindow.close(),infoWindow_open=!1)})):marker.setPosition(a);null==marker.getMap()&&marker.setMap(map);"undefined"!==typeof b?map.fitBounds(b,26):"undefined"!==typeof accuCircle&&accuCircle.setOptions({fillOpacity:.1});map.panTo(a);map.panBy(0,getPanByOffset());
infoWindow_setContent(MESSAGE_LOADING);infoWindow.open(map,marker);infoWindow_open=!0}function getPanByOffset(){return 1E3>window.innerHeight?-118:0}function locate(a){if(locationAccessCheck())pendingLocate=!1,locateExec();else{var b=a||!locationAccessDNDstatus();a||!locationAccessDNDcheck()?(pendingLocate=!0,showLocateRightMessage(b)):wait_loader.classList.add("hide")}}
function locateExec(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){setLocationAccess(!0);var b={lat:a.coords.latitude,lng:a.coords.longitude};"undefined"===typeof accuCircle?accuCircle=new google.maps.Circle({strokeColor:"#69B7CF",strokeOpacity:0,strokeWeight:0,fillColor:"#69B7CF",fillOpacity:.35,map:map,center:b,radius:a.coords.accuracy,clickable:!1}):(accuCircle.setOptions({fillOpacity:.35}),accuCircle.setCenter(b),accuCircle.setRadius(a.coords.accuracy));"undefined"===
typeof myLocDot?myLocDot=new google.maps.Marker({clickable:!1,icon:new google.maps.MarkerImage("https://maps.gstatic.com/mapfiles/mobile/mobileimgs2.png",new google.maps.Size(22,22),new google.maps.Point(0,18),new google.maps.Point(11,11)),shadow:null,zIndex:999,map:map,position:b}):myLocDot.setPosition(b);0==initWCode?(focus_(b,accuCircle.getBounds()),encode(b),getAddress(b)):(initWCode=!1,map.setZoom(12))},function(a){(a.code=a.PERMISSION_DENIED)?(showNotification(LOCATION_PERMISSION_DENIED),setLocationAccess(!1),
wait_loader.classList.add("hide")):handleLocationError(!0,infoWindow,map.getCenter())}):handleLocationError(!1,infoWindow,map.getCenter())}function handleLocationError(a,b,c){showNotification(a?"Error: The Geolocation service failed":"Error: Your browser doesn't support geolocation");notification_top.classList.remove("hide")}
function setInfoWindowText(a,b){infoWindow_setContent("<div id='infowindow_code'><div id='infowindow_code_left'><span class='slash'>\\</span> <span class='infowindow_code' id='infowindow_code_left_code'>"+a[0]+"</span></div><div id='infowindow_code_right'><span class='infowindow_code' id='infowindow_code_right_code'>"+a.slice(1,a.length).join(" ")+"</span> <span class='slash'>/</span></div></div><div id='infowindow_actions' class='center'><img id='show_address_button' class='control' onclick='toggleAddress();' src='/resource/address.svg' ><img id='copy_code_button' class='control' onclick='showCopyWcodeMessage();' src='/resource/copy.svg' ><img id='copy_link_button' class='control' onclick='copyWcodeLink();' src='/resource/link.svg' ><a href='"+
getIntentURL(b,a)+"'><img id='external_map_button' class='control' onclick='' src='/resource/map.svg' ></a></div>")}function getIntentURL(a,b){return navigator.userAgent.match(/android/i)?"geo:0,0?q="+a.lat+","+a.lng+"(\\ "+b.join(" ")+" /)":"https://maps.google.com/maps?q=loc:"+a.lat+","+a.lng+"&t=h"}function clearMap(){null!=marker&&marker.setMap(null)}function infoWindow_setContent(a){"undefined"==typeof infoWindow&&(infoWindow=new google.maps.InfoWindow({map:map}));infoWindow.setContent(a)}
function arrayContainsArray(a,b){return b.every(function(b){return 0<=a.indexOf(b.toLowerCase())})}function clearURL(){""!=window.location.pathname.substr(1)&&window.history.pushState({html:"",pageTitle:""},"","/")}var wcode_city,wcode_code,wcode_postition;function setWcode(a,b){wcode_city=a[0];wcode_code=a.slice(1,a.length);wcode_postition=b;setInfoWindowText(a,b)}function clearWcode(){wcode_postition=wcode_array=null}function getWcodeFull(){return[wcode_city].concat(wcode_code)}
function formatWcode(a){return["\\"].concat(a).concat(["/"])}function getWcodeFull_formatted(){return formatWcode(getWcodeFull())}function getWcodeCode(){return wcode_code}function getWcodeCode_formatted(){return formatWcode(getWcodeCode())}function getWcodeCity(){return wcode_city}window.onload=init;
function init(){overlay.addEventListener("click",hideOverlay);overlay_message_close.addEventListener("click",hideOverlay);info.addEventListener("click",showOverlay);no_city_message_close.addEventListener("click",hideNoCityMessage);locate_right_message_close.addEventListener("click",hideLocateRightMessage);locate_right_message_yes.addEventListener("click",locateRight_grant);locate_right_message_no.addEventListener("click",locateRight_deny);no_city_submit_yes.addEventListener("click",noCity_add);no_city_submit_no.addEventListener("click",
noCity_cancel);no_city_submit_wait_continue.addEventListener("click",noCityWait_continue);no_city_submit_wait_stop.addEventListener("click",noCityWait_stop);notification_top.addEventListener("click",tryDefaultCity);copy_wcode_message_close.addEventListener("click",hideCopyWcodeMessage);copy_wcode_submit_yes.addEventListener("click",copyWcodeFull);copy_wcode_submit_no.addEventListener("click",copyWcodeCode)}function showAndCopy(a){showNotification(a);copyNodeText(notification_bottom)}
function copyNodeText(a){var b=document.createRange();b.selectNode(a);window.getSelection().removeAllRanges();window.getSelection().addRange(b);document.execCommand("copy");window.getSelection().removeAllRanges()}
function WordList(a){this.wordList=a;this.curList=[];a=$jscomp.makeIterator(this.wordList);for(var b=a.next();!b.done;b=a.next())x=b.value,this.curList.push(x[0]);this.indexOf=function(a){for(var b=0;1024>b;b++)if(-1!=this.wordList[b].indexOf(a))return b;return-1};this.getWord=function(a){return this.curList[a]};this.includes=function(a){for(var b=$jscomp.makeIterator(this.wordList),c=b.next();!c.done;c=b.next()){group=c.value;for(var c=$jscomp.makeIterator(group),f=c.next();!f.done;f=c.next())if(entry=
f.value,entry==a)return!0}return!1}};
